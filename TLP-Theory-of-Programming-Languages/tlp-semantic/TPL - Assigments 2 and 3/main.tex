\documentclass{article}

% Language setting
% Replace `english' with e.g. `spanish' to change the document language
\usepackage[english]{babel}

% Set page size and margins
% Replace `letterpaper' with`a4paper' for UK/EU standard size
\usepackage[letterpaper,top=2cm,bottom=2cm,left=3cm,right=3cm,marginparwidth=1.75cm]{geometry}

% Useful packages
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{graphicx}
\usepackage{stmaryrd}
\usepackage[colorlinks=true, allcolors=blue]{hyperref}
\usepackage{amssymb}
\usepackage{ebproof}
\newcommand{\rep}{\texttt{repeat $S$ until $b$ }}
\newcommand{\for}{\texttt{for $x:=e_1$ to $e_2$ do $S$ }}
\newcommand{\forp}{\texttt{for $x:=e_1 + 1$ to $e_2$ do $S$ }}
\newcommand{\whl}{\texttt{$S$; while $\neg b$ do $S$}}
\newcommand{\while}{\texttt{while $b$ do $S$}}
\newcommand{\whileneg}{\texttt{while $\neg b$ do $S$}}
\newcommand{\qed}{\begin{flushright}\rule{0.7em}{0.7em}\end{flushright}}
\newcommand{\sangle}[2]{\langle #1, #2 \rangle}
\newcommand{\bigs}[3]{\sangle{#1}{#2}\Downarrow #3}
\newcommand{\smalls}[3]{\sangle{#1}{#2} \longrightarrow #3}
\newcommand{\bcal}{\mathcal{B}}
\newcommand{\bool}[3]{\bcal \llbracket #1 \rrbracket #2 = #3}


\title{}
\date{}
\author{Rafael Fern√°ndez Ortiz}

\begin{document}
\maketitle

\section*{Assignments 2}
\subsection*{Exercise 2}
\begin{enumerate}
\item[] Assume we extend the syntax of $While$ statements with a new construct: \rep. This statement is executed as follows:
    \begin{enumerate}
        \item[(1)] Execute $S$.
        \item[(2)] Check whether $b$ is false. In this case, step back to (1). Otherwise, finish.
    \end{enumerate}
    Define the big-step and small-step semantic rules for this new construct. You cannot rely on the rules of \texttt{while} to define the rules of \texttt{repeat}. Finally, prove that \rep is equivalent to (\whl)
\end{enumerate}
\subsubsection*{Definition of big-step and small-step semantic rules}
Let $b \in BExp$ and $S \in Stm$ be. We can define the big-step and small-step semantic rules for \rep constructor as follow:\\
\begin{enumerate}
\item[(a)] \textbf{Big-step rules}.\\
\begin{equation*}
    \begin{prooftree}
        \hypo{\bigs{S}{\sigma}{\sigma'}}
        \hypo{\bool{b}{\sigma'}{true}}
        \infer2[ [UntilT_{BS}] ]{\bigs{\rep}{\sigma}{\sigma'}}
    \end{prooftree}
\end{equation*}\\
\begin{equation*}
    \begin{prooftree}
        \hypo{\bigs{S}{\sigma}{\sigma''}}
        \hypo{\bool{b}{\sigma''}{false}}
        \hypo{\bigs{\rep}{\sigma''}{\sigma'}}
        \infer3[ [UntilF_{BS}] ]{\bigs{\rep}{\sigma}{\sigma'}}
    \end{prooftree}
\end{equation*}\\

\item[(b)] \textbf{Small-step rules}. The small step semantics is defined by rewriting steps.
\begin{equation*}
    \begin{prooftree}
        \hypo{}
        \infer1[ [Until_{SS}] ]{\smalls{\rep}{\sigma}{\sangle{\texttt{$S$; if $b$ then skip else \rep}}{\sigma}}}
    \end{prooftree}
\end{equation*}
\end{enumerate}
\subsubsection*{Proof the equivalence}
In order to proof that both expression in the extension of while semantic are equivalent, we need to see $$\bigs{\rep}{\sigma}{\sigma'} \iff  \bigs{\whl}{\sigma}{\sigma'}$$
For this purpose, we will prove a base case. Then we will continue by applying rule-induction.\\

\subsubsection*{Proof. $\Rightarrow$}\\\\
\textbf{Base case.}\\

Let's consider a statement $S \in Stm$, a boolean expression $b \in BExp$ and any states $\sigma, \sigma' \in State$. The base case is when the semantic denotational of $b$ is true for any $\sigma'$. We assume that $$(\whl)$$\\\\
holds. Therefore we know that there is a derivation tree for it:

\begin{equation}
    \begin{prooftree}
        \hypo{\bigs{S}{\sigma}{\sigma'}}
        \hypo{\bool{b}{\sigma'}{true}}
        \infer2[ [UntilT_{BS}] ]{\bigs{\rep}{\sigma}{\sigma'}}
    \end{prooftree}
\end{equation}\\\\
We can rewrite $\bool{b}{\sigma'}{true}$ to $\bool{\neg b}{\sigma'}{false}$ and reshape the $WhileF_{BS}$ rule as follow:

\begin{equation}
    \begin{prooftree}
        \hypo{\bool{\neg b}{\sigma}{false}}
        \infer1[ [WhileF_{BS}] ]{\bigs{\whileneg}{\sigma}{\sigma}}
    \end{prooftree}
\end{equation}\\\\
Therefore, using the same assertions in (1) and appliying the $Seq_{BS}$ rule and (2), we obtain:

\begin{equation*}
    \begin{prooftree}
        \hypo{\bigs{S}{\sigma}{\sigma'}}
        \hypo{\bool{\neg b}{\sigma'}{false}}
        \infer1[ [WhileF_{BS}] ]{\bigs{\whileneg}{\sigma'}{\sigma'}}
        \infer2[ [Seq_{BS}] ]{\bigs{\whl}{\sigma}{\sigma'}}
    \end{prooftree}
\end{equation*}\\\\
That will be our induction hypothesis (IH). Now, we have to prove the inductive case, i.e when the semantic denotational of the boolean expression $b$ is false. In this case and being rigorous, we can consider that exist a knowed $k \in \mathbb{N}$ such that $\bool{ b}{\sigma_k}{true}$ and before that $\bool{ b}{\sigma_i}{false}$ for all $i \in \mathbb{N}$ with $i \leq k$.\\\\
\textbf{Inductive case.}\\

Let $S \in Stm$, $b \in BExp$, $\sigma, \sigma' \in State$ be and let $k \in \mathbb{N}$ be a natural number such that $\bool{ b}{\sigma_k}{true}$ and $\bool{ b}{\sigma_i}{false}$ for all $i \in \mathbb{N}$ with $i \leq k$.\\\\
We can assume that exist a derivation tree with root $$\bigs{\rep}{\sigma}{\sigma'}$$ such that is obtained by derivating and apliying $UntilF_{BS}$ in all $T_i$ subtree (for each i-big-step) and finally we obtain:

\begin{equation*}
    \begin{prooftree}
        \hypo{\bigs{S}{\sigma}{\sigma_1}}
        \hypo{\bool{b}{\sigma_1}{false}}
        \hypo{\bigs{\rep}{\sigma_1}{\sigma_2}}
        \infer3[ [UntilF_{BS}] ]{\bigs{\rep}{\sigma}{\sigma_2}}
        \infer1{$\vdots$}
    \end{prooftree}
\end{equation*}

\begin{equation*}
    \begin{prooftree}
        \hypo{\bigs{S}{\sigma}{\sigma_k}}
        \hypo{\bool{b}{\sigma_k}{true}}
        \hypo{\bigs{\rep}{\sigma_k}{\sigma'}}
        \infer3[ ]{}
    \end{prooftree}
\end{equation*}\\
How we have obtained both $\bigs{S}{\sigma}{\sigma_k}$ and $\bool{\neg b}{\sigma_k}{false}$ ($\bool{b}{\sigma_k}{true}$) assertions. By IH results:

\begin{equation*}
    \begin{prooftree}
        \hypo{\bigs{S}{\sigma}{\sigma_k}}
        \hypo{\bool{\neg b}{\sigma_k}{false}}
        \infer2[ [ IH ] ]{\bigs{\whl}{\sigma}{\sigma'}}
    \end{prooftree}
\end{equation*}
Therefore

\begin{equation*}
    \begin{prooftree}
        \hypo{\bigs{S}{\sigma}{\sigma_k}}
        \hypo{\bool{\neg b}{\sigma_k}{false}}
        \hypo{\bigs{\rep}{\sigma_k}{\sigma'}}
        \infer3[ [ IH ] ]{\bigs{\whl}{\sigma}{\sigma'}}
    \end{prooftree}
\end{equation*}
and finally

\begin{equation*}
    \begin{prooftree}
        \hypo{\bigs{S}{\sigma}{\sigma_k}}
        \hypo{\bool{\neg b}{\sigma_k}{false}}
        \hypo{\bigs{\whl}{\sigma_k}{\sigma'}}
        \infer3[ [ IH ] ]{\bigs{\whl}{\sigma}{\sigma'}}
    \end{prooftree}
\end{equation*}

\subsubsection*{Proof. $\Leftarrow$}\\
In order to prove this sense, we can proceed very similar as before. Assuming that $\bigs{\whl}{\sigma}{\sigma'}$ holds, we have to deconstruct it in its assertions that is derivated in and to considerate the case base when the boolean expression is false.\\\\
\textbf{Base case.}\\

Let a statement $S \in Stm$, a boolean expression $b \in BExp$ and any states $\sigma, \sigma' \in State$ be. We assume $\bigs{\whl}{\sigma}{\sigma'}$ holds. So we have the following derivation tree:

\begin{equation}
    \begin{prooftree}
        \hypo{\bigs{S}{\sigma}{\sigma'}}
        \hypo{\bigs{\whileneg}{\sigma}{\sigma'}}
        \infer2[ [Seq_{BS}] ]{\bigs{\whl}{\sigma}{\sigma'}}
    \end{prooftree}
\end{equation}\\\\
Furthermore, since we assume that $\bigs{\whileneg}{\sigma}{\sigma'}$ holds, then there is a derivation subtree for that expression from which it is derived.

\begin{equation*}
    \begin{prooftree}
        \hypo{\bool{\neg b}{\sigma'}{false}}
        \infer1[ [WhileF_{BS}] ]{\bigs{\whileneg}{\sigma}{\sigma'}}
    \end{prooftree}
\end{equation*}
And by rewriting the boolean expression
\begin{equation}
    \begin{prooftree}
        \hypo{\bool{b}{\sigma'}{true}}
        \infer1[ [WhileF_{BS}] ]{\bigs{\whileneg}{\sigma}{\sigma'}}
    \end{prooftree}
\end{equation}\\
Thus, combining (3) and (4) we finally obtain
\begin{equation}
    \begin{prooftree}
        \hypo{\bigs{S}{\sigma}{\sigma'}}
        \hypo{\bool{b}{\sigma'}{true}}
        \infer1[ [WhileF_{BS}] ]{\bigs{\whileneg}{\sigma}{\sigma'}}
        \infer3[ [Seq_{BS}] ]{\bigs{\whl}{\sigma}{\sigma'}}
    \end{prooftree}
\end{equation}\\
On the other hand, using the same assertions in the equation (5), we obtain by definition:
\begin{equation*}
    \begin{prooftree}
        \hypo{\bigs{S}{\sigma}{\sigma'}}
        \hypo{\bool{b}{\sigma'}{true}}
        \infer2[ [UntilT_{BS}] ]{\bigs{\rep}{\sigma}{\sigma'}}
    \end{prooftree}
\end{equation*}\\\\
\textbf{Inductive case.}\\\\
We can prove the inductive case analogously at the right sense of the proof.\\

Let $S \in Stm$, $b \in BExp$, $\sigma, \sigma' \in State$ be and let $k \in \mathbb{N}$ be a natural number such that $\bool{\neg b}{\sigma_k}{false}$ and $\bool{\neg b}{\sigma_i}{true}$ for all $i \in \mathbb{N}$ with $i \leq k$.\\\\
We can assume that exist a derivation tree with root $$\bigs{\whl}{\sigma}{\sigma'}$$ such that is obtained by derivating and applying $WhileF_{BS}$ in all $T_i$ subtree (for each i-big-step):
\begin{equation*}
    \begin{prooftree}
        \hypo{\bigs{S}{\sigma}{\sigma_1}}
        \hypo{\bool{\neg b}{\sigma_1}{true}}
        \hypo{\bigs{\whileneg}{\sigma_1}{\sigma_2}}
        \infer3[ [WhileF_{BS}] ]{\bigs{\whileneg}{\sigma}{\sigma_2}}
        \infer1{$\vdots$}
    \end{prooftree}
\end{equation*}

\begin{equation}
    \begin{prooftree}
        \hypo{\bigs{S}{\sigma}{\sigma_k}}
        \hypo{\bool{\neg b}{\sigma_k}{false}}
        \hypo{\bigs{\whileneg}{\sigma_k}{\sigma'}}
        \infer3[ ]{}
    \end{prooftree}
\end{equation}\\
Then, rewriting the boolean expression and applying inductive hypothesis IH:
\begin{equation}
    \begin{prooftree}
        \hypo{\bigs{S}{\sigma}{\sigma_k}}
        \hypo{\bool{b}{\sigma_k}{true}}
        \infer2[ [ IH ] ]{\bigs{\rep}{\sigma}{\sigma'}}
    \end{prooftree}
\end{equation}\\
Combining (6) and (7)\\
\begin{equation*}
    \begin{prooftree}
        \hypo{\bigs{S}{\sigma}{\sigma_k}}
        \hypo{\bool{b}{\sigma_k}{true}}
        \hypo{\bigs{\whileneg}{\sigma_k}{\sigma'}}
        \infer3[ [ IH ] ]{\bigs{\rep}{\sigma}{\sigma'}}
    \end{prooftree}
\end{equation*}\\

\begin{equation*}
    \begin{prooftree}
        \hypo{\bigs{S}{\sigma}{\sigma''}}
        \hypo{\bool{b}{\sigma''}{false}}
        \hypo{\bigs{\whileneg}{\sigma''}{\sigma'}}
        \infer3[ [ IH ] ]{\bigs{\rep}{\sigma}{\sigma'}}
    \end{prooftree}
\end{equation*}\\
And finally we obtain $UntilF_{BS}$ axiom
\begin{equation*}
    \begin{prooftree}
        \hypo{\bigs{S}{\sigma}{\sigma''}}
        \hypo{\bool{b}{\sigma''}{false}}
        \hypo{\bigs{\rep}{\sigma''}{\sigma'}}
        \infer3[ [UntilF_{BS}] ]{\bigs{\rep}{\sigma}{\sigma'}}
    \end{prooftree}
\end{equation*}\\
\qed\\
\subsection*{Exercise 3}
\begin{enumerate}
\item[] Add the following iterative construct to $While$: \for. Define its big-step and small-step semantic rules. You cannot rely on the while or repeat construct to do this exercise.
\end{enumerate}
\subsubsection*{Definition of big-step and small-step semantic rules}
Let $b \in BExp$ and $S \in Stm$ be. We can define the big-step and small-step semantic rules for \rep constructor as follow:\\
\begin{enumerate}
\item[(a)] \textbf{Big-step rules}.
\begin{equation*}
    \begin{prooftree}
        \hypo{\bool{e_1 \leq e_2}{\sigma}{false}}
        \infer1[ [ForF_{BS}] ]{\bigs{\for}{\sigma}{\sigma[x\Rightarrow \mathcal{A} \llbracket e_1 \rrbracket \sigma} ]}
    \end{prooftree}
\end{equation*}\\
\begin{equation*}
    \begin{prooftree}
        \hypo{\bool{e_1 \leq e_2}{\sigma}{true}}
        \hypo{\bigs{S}{\sigma[x\rightarrow \mathcal{A} \llbracket e_1 \rrbracket \sigma]}{\sigma_1}}
        \hypo{\bigs{\forp}{\sigma_1}{\sigma'}}
        \infer3[ [ForT_{BS}] ]{\bigs{\for}{\sigma}{\sigma'}}
    \end{prooftree}
\end{equation*}\\

\item[(b)] \textbf{Small-step rules}. The small step semantics is defined by rewriting steps.
\begin{equation*}
    \begin{prooftree}
        \hypo{}
        \infer1[ [For_{SS}] ]{\smalls{\for}{\sigma}{\sangle{\texttt{$x:=e_1$; if $e_1 \leq e_2$ then $S_1$ else skip}}{\sigma}}}
    \end{prooftree}
\end{equation*}\\
where $S_1$ = \texttt{($S$; for $x:=e_1 + 1$ to $e_2$ do $S$)}
\end{enumerate}


\end{document}